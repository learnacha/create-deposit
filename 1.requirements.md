# New Deposit Screen â€“ Project-Agnostic Requirements

This document outlines the requirements and business logic for implementing a "New Deposit" screen in a mobile application (e.g., React Native). All API field names are retained as specified. Labels and component/prop names are described as plain text, not as code or keys. The requirements are technology-agnostic and suitable for use as a Product Requirements Document (PRD).

---

## 1. Deal Reference Toggle

- **Label:** "Do you have a deal reference number?"
- **Type:** Radio button (options: "Yes", "No")
- **Default Value:** "No"
- **Behavior:**
  - If "Yes" is selected: Display the following fields:
    - Reference Number
    - Deposit Funding Account
    - Deposit Repayment Account
    - Maturity Instruction
    - Remarks
  - If "No" is selected: Display the following fields:
    - Deposit Funding Account
    - Deposit Repayment Account
    - Amount
    - Start Date
    - Maturity Date
    - Maturity Instruction
    - Remarks
  - Changing this toggle resets all form fields and clears any errors.

---

## 2. Reference Number

- **Label:** "Reference Number"
- **Visibility:** Only shown if "Do you have a deal reference number?" is "Yes"
- **Input Type:** Alphanumeric, maximum 50 characters
- **Validation:**
  - Required field
  - On change, trigger a backend call to validate the reference:
    - Call the API endpoint `/api/v1/deposit-requests/deal-inquiry` with payload:
      - `dealId` (string): Value entered by the user
      - `customerKey` (string): Current customer's key
    - If the reference is invalid, display a user-friendly error and disable preview/submit actions.
    - If valid, populate deal information (amount, currency, accounts, dates, rates, etc.) in the form.
- **Error Handling:** All API errors must be mapped to user-friendly messages.

---

## 3. Deposit Funding Account

- **Label:** "Deposit Funding Account"
- **Visibility:** Always shown
- **Input Type:** Dropdown selection
- **Options Source:** List of accounts retrieved from the backend API `/api/v1/accounts`
- **Filtering Rules:**
  - Only include accounts with:
    - `status` equal to "Active"
    - `currency` in the set: AED, USD, SAR, EUR
    - `productID` includes "CCA" (Corporate Current Account)
    - `rawProductId` is not "ODAZA"
    - For deal flow: Only accounts matching the deal currency
  - Exclude accounts where `debitFrozen` is "1"
  - Sort options by status and account number
- **Validation:**
  - Required field
  - Must not be debit frozen
  - Must be a valid account (API error if not)
- **Error Handling:** All API and validation errors must be displayed as user-friendly messages.

---

## 4. Deposit Repayment Account

- **Label:** "Deposit Repayment Account"
- **Visibility:** Always shown
- **Input Type:** Dropdown selection
- **Options Source:** Same as Deposit Funding Account, but only accounts with the same currency as the selected funding account
- **Validation:**
  - Required field
  - Must not be debit frozen
  - Must be a valid account (API error if not)
- **Error Handling:** All API and validation errors must be displayed as user-friendly messages.

---

## 5. Amount

- **Label:** "Amount"
- **Visibility:** Only shown if "Do you have a deal reference number?" is "No"
- **Input Type:** Numeric (currency input)
- **Currency:** Determined by the selected funding account; defaults to base currency if not selected
- **Validation:**
  - Required field
  - Must be greater than 0
  - Must not exceed the available balance of the selected funding account
  - Must not duplicate an existing request (API error)
- **Error Handling:** All API and validation errors must be displayed as user-friendly messages.

---

## 6. Start Date

- **Label:** "Start Date"
- **Visibility:** Only shown if "Do you have a deal reference number?" is "No"
- **Input Type:** Date picker (disabled, always set to current date)
- **Validation:**
  - Required field
  - Always set to the current date
- **Error Handling:** All validation errors must be displayed as user-friendly messages.

---

## 7. Maturity Date

- **Label:** "Maturity Date"
- **Visibility:** Only shown if "Do you have a deal reference number?" is "No"
- **Input Type:** Date picker
- **Validation:**
  - Required field
  - Must be after the start date
  - Must not exceed the maximum tenor : 365 days
  - Must be at least 7 days from today
  - API error if exceeds allowed tenor
- **Error Handling:** All API and validation errors must be displayed as user-friendly messages.

---

## 8. Maturity Instruction

- **Label:** "Maturity Instruction"
- **Visibility:** Always shown
- **Input Type:** Dropdown selection
- **Options:** Use the following values and display value:
  - PRINCIPAL_PLUS_PROFIT_ENCASHMENT: 'Credit principal plus interest on maturity'
  - PRINCIPAL_ROLLOVER: 'Rollover principal plus interest on maturity'
  - PRINCIPAL: 'Rollover principal only and credit interest on maturity',
- **Validation:** Required field
- **Special Logic:** When selected, display a disclaimer to the user
- **Disclaimer Text:** By selecting auto-rollover on maturity, your deposit will be renewed at standard deposit rates prevailing on the rollover date.
- **Error Handling:** All validation errors must be displayed as user-friendly messages.

---

## 9. Remarks

- **Label:** "Remarks"
- **Visibility:** Always shown (optional field)
- **Input Type:** Text area, maximum 500 characters
- **Validation:** Optional; must match the regex pattern validated by the backend API
- **Error Handling:** All API and validation errors must be displayed as user-friendly messages.

---

## 10. Preview and Submit Flow

- **Preview Action:**
  - When the user clicks "Preview", validate all fields.
  - If valid:
    - For deal flow: Call the API endpoint `/api/v1/deposit-requests/validate` with the following payload:
      - `dealReference`, `fundingAccount`, `repaymentAccount`, `amount`, `startDate`, `numberOfDays`, `maturityInstruction`, `remarks`, `currency`
    - For normal flow: Call the same endpoint with the same fields, except `dealReference` is omitted.
    - If validation passes (no errors), for normal flow, call the API endpoint `/api/v1/deposit-requests/rate-inquiry` to fetch rate and maturity information for preview.
    - If validation fails, display all errors mapped to the relevant fields.
- **Submit Action:**
  - When the user clicks "Submit", call the API endpoint `/api/v1/deposit-requests` with the current payload.
  - On success: Display a success message, close the form, and navigate to the deposit requests list.
  - On failure: Display all errors mapped to the relevant fields.

---

## 11. API Specifications

### a. Deal Reference Info

- **Endpoint:** `POST /api/v1/deposit-requests/deal-inquiry`
- **Request Payload:**
  - `dealId` (string, required)
  - `customerKey` (string, required)
- **Response (Success):** Object with deal details (see original for all fields)
- **Response (Error):** Object with `errors` array

**Example:**
  ```json
  {
    "dealId": "DEAL123456",
    "customerKey": "CUSTKEY001"
  }
  ```

- **Response (Success)**:
  - Returns an object with deal details, e.g.:
    - `amount` (number, required): Deal amount.
    - `currency` (string, required): Deal currency.
    - `fundingAccount` (string, required): Funding account number.
    - `repaymentAccount` (string, optional): Repayment account number.
    - `startDate` (string, required): ISO date string.
    - `maturityDate` (string, required): ISO date string.
    - `numberOfDays` (number, required): Tenor in days.
    - `standardRate` (number, optional): Standard interest rate.
    - `specialRate` (number, optional): Special interest rate.
    - `maturityAmount` (number, required): Amount at maturity.
    - ...other deal-specific fields as provided by backend.

  **Example:**
  ```json
  {
    "amount": 100000,
    "currency": "AED",
    "fundingAccount": "1234567890",
    "repaymentAccount": "0987654321",
    "startDate": "2025-08-05",
    "maturityDate": "2026-08-05",
    "numberOfDays": 366,
    "standardRate": 2.5,
    "specialRate": 3.0,
    "maturityAmount": 103000
  }
  ```

  - **Response (Error/Invalid)**:
  - Returns an object with an `errors` array describing the issues (e.g., invalid or expired deal reference).
  - The UI maps these errors to user-friendly messages and disables preview/submit.

  **Example:**
  ```json
  {
    "errors": [
      {
        "field": "dealId",
        "message": "Invalid deal reference"
      }
    ]
  }
  ```
  
---

### b. Accounts List

- **Endpoint:** `GET /api/v1/accounts`
- **Response (Success):** Array of account objects (see original for all fields)
- **Response (Error):** Standard error object

## API: Deposit Funding Account (Accounts List)

- **Endpoint**:  
  `GET /api/v1/accounts`

- **Request Parameters**:  
  - None required for standard customer usage.

- **Response (Success)**:  
  Returns an array of account objects. Each object may include:
    - `accountId` (string, required): Unique account number.
    - `name` (string, required): Account name.
    - `availableBalance` (number, required): Available balance.
    - `currencyID` (string, required): Currency code (e.g., "AED").
    - `status` (string, required): Account status (e.g., "Active").
    - `productID` (string, required): Product type (e.g., "CCA").
    - `creditFrozen` (string/number, optional): Credit frozen status.
    - `debitFrozen` (string/number, optional): Debit frozen status.
    - `rawProductId` (string, optional): Raw product code.
    - ...other backend-provided fields.

  **Example:**
  ```json
  [
    {
      "accountId": "1234567890",
      "name": "Main Corporate Account",
      "availableBalance": 500000,
      "currencyID": "AED",
      "status": "Active",
      "productID": "CCA",
      "creditFrozen": "0",
      "debitFrozen": "0",
      "rawProductId": "CCA"
    },
    {
      "accountId": "9876543210",
      "name": "USD Account",
      "availableBalance": 100000,
      "currencyID": "USD",
      "status": "Active",
      "productID": "CCA",
      "creditFrozen": "0",
      "debitFrozen": "1",
      "rawProductId": "CCA"
    }
  ]
  ```

- **Response (Error)**:  
  - Standard error object with error details if the request fails.

- **Notes**:  
  - The UI filters this list for status, currency, product, and frozen status before displaying as funding account options.

---

### c. Validate New Deposit

- **Endpoint:** `POST /api/v1/deposit-requests/validate`
- **Request Payload:** See "Preview Action" above
- **Response (Success):** Object (may be empty or contain validation info)
- **Response (Error):** Object with `errors` array

- **Endpoint**:  
  `POST /api/v1/deposit-requests/validate`

- **Request Payload**:  
  - For deal flow:  
    - `dealReference` (string, required)
    - `fundingAccount` (string, required)
    - `repaymentAccount` (string, required)
    - `amount` (number, required)
    - `startDate` (string, required, format: YYYY-MM-DD)
    - `numberOfDays` (number, required)
    - `maturityInstruction` (string, required)
    - `remarks` (string, optional)
    - `currency` (string, required)
  - For normal flow:  
    - `fundingAccount` (string, required)
    - `repaymentAccount` (string, required)
    - `currency` (string, required)
    - `amount` (number, required)
    - `startDate` (string, required, format: YYYY-MM-DD)
    - `numberOfDays` (number, required)
    - `maturityInstruction` (string, required)
    - `remarks` (string, optional)

  **Example:**
  ```json
  {
    "fundingAccount": "1234567890",
    "repaymentAccount": "0987654321",
    "currency": "AED",
    "amount": 100000,
    "startDate": "2025-08-05",
    "numberOfDays": 366,
    "maturityInstruction": "PRINCIPAL_PLUS_PROFIT_ENCASHMENT",
    "remarks": "Test deposit"
  }
  ```

- **Response (Success)**:  
  - Returns an object (may be empty or contain validation info).
  - If further info is needed for preview, the UI will call rate inquiry.

- **Response (Error/Invalid)**:  
  - Returns an object with an `errors` array describing the issues (e.g., field errors, pattern mismatch, exceeds balance, duplicate request, etc.).
  - The UI maps these errors to user-friendly messages and disables preview/submit.

  **Example:**
  ```json
  {
    "errors": [
      {
        "field": "amount",
        "message": "deposit.amount.exceeds-balance"
      },
      {
        "field": "remarks",
        "message": "Pattern"
      }
    ]
  }
  ```

---

### d. Rate Inquiry

- **Endpoint:** `POST /api/v1/deposit-requests/rate-inquiry`
- **Request Payload:**
  - `depositAmount` (number, required)
  - `numberOfDays` (number, required)
  - `currency` (string, required)
  - `startDate` (string, required, format: YYYY-MM-DD)
- **Response (Success):** Object with rate and maturity info
- **Response (Error):** Object with `errors` array

### 2. Rate Inquiry (for Preview)

- **Endpoint**:  
  `POST /api/v1/deposit-requests/rate-inquiry`

- **Request Payload**:  
  - `depositAmount` (number, required)
  - `numberOfDays` (number, required)
  - `currency` (string, required)
  - `startDate` (string, required, format: YYYY-MM-DD)

  **Example:**
  ```json
  {
    "depositAmount": 100000,
    "numberOfDays": 366,
    "currency": "AED",
    "startDate": "2025-08-05"
  }
  ```

- **Response (Success)**:  
  - Returns an object with rate and maturity info:
    - `interestRate` (number, required): Calculated interest rate.
    - `maturityAmount` (number, required): Amount at maturity.
    - `maturityDate` (string, required): Calculated maturity date (YYYY-MM-DD).
    - ...other backend-provided fields.

  **Example:**
  ```json
  {
    "interestRate": 2.5,
    "maturityAmount": 103000,
    "maturityDate": "2026-08-05"
  }
  ```

- **Response (Error/Invalid)**:  
  - Returns an object with an `errors` array describing the issues (e.g., invalid input, exceeds allowed tenor, etc.).
  - The UI maps these errors to user-friendly messages and disables preview/submit.

  **Example:**
  ```json
  {
    "errors": [
      {
        "field": "numberOfDays",
        "message": "deposit.maturityDate.exceeds-max-tenor"
      }
    ]
  }
  ```

---

### e. Create Deposit

- **Endpoint:** `POST /api/v1/deposit-requests`
- **Request Payload:** See "Submit Action" above
- **Response (Success):** Object with confirmation details
- **Response (Error):** Object with `errors` array

## API: Submit Event (Create Deposit)

- **Endpoint**:  
  `POST /api/v1/deposit-requests`

- **Request Payload**:  
  - For deal flow:  
    - `dealReference` (string, required)
    - `fundingAccount` (string, required)
    - `repaymentAccount` (string, required)
    - `amount` (number, required)
    - `startDate` (string, required, format: YYYY-MM-DD)
    - `numberOfDays` (number, required)
    - `maturityInstruction` (string, required)
    - `remarks` (string, optional)
    - `currency` (string, required)
  - For normal flow:  
    - `fundingAccount` (string, required)
    - `repaymentAccount` (string, required)
    - `currency` (string, required)
    - `amount` (number, required)
    - `startDate` (string, required, format: YYYY-MM-DD)
    - `numberOfDays` (number, required)
    - `maturityInstruction` (string, required)
    - `remarks` (string, optional)

  **Example:**
  ```json
  {
    "fundingAccount": "1234567890",
    "repaymentAccount": "0987654321",
    "currency": "AED",
    "amount": 100000,
    "startDate": "2025-08-05",
    "numberOfDays": 366,
    "maturityInstruction": "PRINCIPAL_PLUS_PROFIT_ENCASHMENT",
    "remarks": "Test deposit"
  }
  ```

- **Response (Success)**:  
  - Returns an object with confirmation details, e.g.:
    - `reference` (string, required): Deposit request reference.
    - `status` (string, required): Submission status.
    - ...other backend-provided fields.

  **Example:**
  ```json
  {
    "reference": "DEP123456789",
    "status": "SUBMITTED"
  }
  ```

- **Response (Error/Invalid)**:  
  - Returns an object with an `errors` array describing the issues (e.g., field errors, pattern mismatch, exceeds balance, duplicate request, etc.).
  - The UI maps these errors to user-friendly messages and disables further actions.

  **Example:**
  ```json
  {
    "errors": [
      {
        "field": "amount",
        "message": "deposit.amount.exceeds-balance"
      }
    ]
  }
  ```

---

## 12. Additional Business Logic

- **Account Mapping:** Map raw account data from the API to display fields: name, account number, balance, currency, status, productID, frozen status.
- **Repayment Account Filtering:** Only show repayment accounts with the same currency as the selected funding account.
- **Days Calculation:** Calculate the number of days between start and maturity date for display and API payload.
- **Form Reset:** Reset all fields to default values and clear validation state when the deal reference toggle is changed.
- **Terms & Conditions:** User must accept terms and conditions before submitting the form.

---

## 13. Error Handling

- All API errors must be collected and mapped to the relevant fields as user-friendly messages.
- Accounts with debit frozen status must not be selectable.
- Repayment account currency must match the funding account currency.

---

## 14. Data Flow Summary

1. **Accounts:** Load on screen mount via API, filter and map for dropdowns.
2. **Deal Info:** If a deal reference is entered, validate via API and use to populate preview fields.
3. **Validation:** All fields must be validated both on the client and via API.
4. **Preview:** Validate and fetch rate/maturity info for preview.
5. **Submit:** Send payload to create deposit via API.

---

## 15. Acceptance Criteria

- All field labels, API field names, and business logic must be implemented as described.
- All error handling and validation must be user-friendly and comprehensive.
- The screen must support both deal and non-deal flows as described.
- The requirements are agnostic to any specific technology or component library.


--- 
I want to build this in react native application using typescript, rtk query
I already have components as below:
ToggleSwitch
CustomInput - text input
DatePicker
AccountSelection
ItemSelection - Dropdown


how to architect this flow in react native with typescript?
consider reusability, modularization, etc

do not provide code, suggest me only implementation steps 
like component, hooks, utils designs etc
